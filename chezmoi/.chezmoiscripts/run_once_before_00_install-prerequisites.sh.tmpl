#!/bin/bash
# Install prerequisites before other chezmoi operations
# This runs once on first chezmoi apply

set -e

echo "=== Installing Prerequisites ==="

{{ if eq .chezmoi.os "darwin" -}}
# macOS: Install Homebrew if not present
if ! command -v brew &> /dev/null; then
    echo "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install essential tools
brew install git curl
{{ else if eq .chezmoi.os "linux" -}}
# Linux: Install essentials
{{ if eq .chezmoi.osRelease.id "ubuntu" "debian" "linuxmint" "pop" -}}
sudo apt update
sudo apt install -y git curl wget ca-certificates gnupg
{{ else if eq .chezmoi.osRelease.id "arch" "cachyos" "endeavouros" "manjaro" -}}
sudo pacman -Sy --noconfirm --needed git curl wget ca-certificates
{{ else if eq .chezmoi.osRelease.id "fedora" -}}
sudo dnf install -y git curl wget
{{ end -}}
{{ end -}}

echo "Prerequisites installed!"
